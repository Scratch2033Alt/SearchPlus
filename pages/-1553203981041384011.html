<!DOCTYPE html>
<html dir="ltr" typeof="bibo:Document " prefix="bibo: http://purl.org/ontology/bibo/ w3p: http://www.w3.org/2001/02pd/rec54#" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="dc:language" content="en" lang="">
  <style>
    /*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

    .hljs {
      display: block;
      overflow-x: auto;
      padding: 0.5em;
      color: #333;
      background: #f8f8f8;
    }

    .hljs-comment,
    .hljs-quote {
      color: #998;
      font-style: italic;
    }

    .hljs-keyword,
    .hljs-selector-tag,
    .hljs-subst {
      color: #333;
      font-weight: bold;
    }

    .hljs-number,
    .hljs-literal,
    .hljs-variable,
    .hljs-template-variable,
    .hljs-tag .hljs-attr {
      color: #008080;
    }

    .hljs-string,
    .hljs-doctag {
      color: #d14;
    }

    .hljs-title,
    .hljs-section,
    .hljs-selector-id {
      color: #900;
      font-weight: bold;
    }

    .hljs-subst {
      font-weight: normal;
    }

    .hljs-type,
    .hljs-class .hljs-title {
      color: #458;
      font-weight: bold;
    }

    .hljs-tag,
    .hljs-name,
    .hljs-attribute {
      color: #000080;
      font-weight: normal;
    }

    .hljs-regexp,
    .hljs-link {
      color: #009926;
    }

    .hljs-symbol,
    .hljs-bullet {
      color: #990073;
    }

    .hljs-built_in,
    .hljs-builtin-name {
      color: #0086b3;
    }

    .hljs-meta {
      color: #999;
      font-weight: bold;
    }

    .hljs-deletion {
      background: #fdd;
    }

    .hljs-addition {
      background: #dfd;
    }

    .hljs-emphasis {
      font-style: italic;
    }

    .hljs-strong {
      font-weight: bold;
    }
  </style>
  <title>SHACL JavaScript Extensions</title>



  <style>
    pre {
      tab-size: 3;
      -moz-tab-size: 3;
      /* Code for Firefox */
      -o-tab-size: 3;
      /* Code for Opera */
    }

    th {
      text-align: left;
    }

    table.rule {
      background-color: #EBEBE0;
    }

    table.rule td {
      text-align: center;
    }

    td.up {
      border-bottom: 1px solid black;
    }

    td {
      vertical-align: top;
    }

    .algorithm {
      background: #fafafc;
      border-left-style: solid;
      border-left-width: .5em;
      border-color: #c0c0c0;
      margin-bottom: 16px;
      padding: 8px;
    }

    .arg {
      font-weight: bold;
      color: #000080;
    }

    .def {
      background: #fcfcfc;
      border-left-style: solid;
      border-left-width: .5em;
      border-color: #c0c0c0;
      margin-bottom: 16px;
    }

    .def-sparql {}

    .def-sparql-body {
      margin-top: 0px;
      margin-bottom: 0px;
    }

    .def-text {}

    .def-text-body {}

    .def-header {
      color: #a0a0a0;
      font-size: 16px;
      padding-bottom: 8px;
    }

    .diagram-class {
      border: 1px solid black;
      border-radius: 4px;
      width: 360px;
    }

    .diagram-class-name {
      font-size: 16px;
      font-weight: bold;
      text-align: center;
    }

    .diagram-class-properties {
      border-top: 1px solid black;
    }

    .diagram-class-properties-start {
      padding: 8px;
    }

    .diagram-class-properties-section {
      border-top: 1px dashed #808080;
      padding: 8px;
    }

    .focus-node-selected {
      color: blue;
    }

    .focus-node-error {
      color: red;
    }

    .triple-can-be-skipped {
      color: grey;
    }

    .focus-node-error {
      color: red;
    }

    .target-can-be-skipped {
      color: darkslategray;
      font-style: italic;
    }

    .component-class {
      font-weight: bold;
      font-size: 16px;
    }

    .parameter-context {
      font-weight: bold;
      font-size: 16px;
    }

    .parameters {
      font-weight: bold;
      font-size: 16px;
    }

    .part-header {
      font-weight: bold;
    }

    .syntax {
      border-left-style: solid;
      border-left-width: .5em;
      border-color: #d0d0d0;
      margin-bottom: 16px;
      padding: .5em 1em;
      background-color: #f6f6f6;
    }

    .syntax-rule-id {
      padding-right: 10px;
    }

    .syntax-rule-id-a {
      white-space: nowrap;
    }

    .validator-id-a {
      font-weight: bold;
      white-space: nowrap;
    }

    .term {
      font-style: italic;
    }

    .term-def-header {
      font-style: italic;
      font-weight: bold;
    }

    .term-table {
      border-collapse: collapse;
      border-color: #000000;
      margin: 16px;
    }

    .term-table td,
    th {
      border-width: 1px;
      border-style: solid;
      padding: 5px;
    }

    .todo {
      color: red;
    }
    /* Attempt at fixing unwanted line breaks in some browsers */

    pre {
      word-wrap: normal;
    }
    /* example pre taken / adapted from R2RML */

    pre.shapes,
    pre.example-shapes,
    pre.example-data,
    pre.example-js,
    pre.example-results,
    pre.example-other {
      margin-left: 0;
      padding: 0 2em;
      margin-top: 1.5em;
      padding: 1em;
    }

    pre.example-shapes:before,
    pre.example-data:before,
    pre.example-js:before,
    pre.example-results:before,
    pre.example-other:before {
      background: white;
      display: block;
      font-family: sans-serif;
      margin: -1em 0 0.4em -1em;
      padding: 0.2em 1em;
    }

    pre.shapes,
    pre.example-shapes {
      background: #deb;
    }

    pre.shapes,
    pre.example-shapes,
    pre.example-shapes:before {
      border: 1px solid #bbb;
    }

    pre.example-shapes:before {
      color: #888;
      content: "Example shapes graph";
      width: 13em;
    }

    pre.example-data {
      background: #eeb;
    }

    pre.example-data,
    pre.example-data:before {
      border: 1px solid #cc9;
    }

    pre.example-data:before {
      color: #996;
      content: "Example data graph";
      width: 13em;
    }

    .example-results {
      background: #edb;
    }

    .example-results,
    .example-results:before,
    .example-results th,
    .example-results td {
      border: 1px solid #cca;
    }

    pre.example-results:before {
      color: #997;
      content: "Example validation results";
      width: 13em;
    }

    pre.example-other {
      background: #bed;
    }

    pre.example-other,
    pre.example-other:before {
      border: 1px solid #ddd;
    }

    pre.example-other:before {
      color: #888;
      content: "Example";
      width: 13em;
    }

    pre.example-js {
      background: #eeccbe;
    }

    pre.example-js,
    pre.example-js:before {
      border: 1px solid #c9c;
    }

    pre.example-js:before {
      color: #996;
      content: "Example JavaScript";
      width: 13em;
    }
    /* our syntax menu for switching */

    div.syntaxmenu {
      border: 1px dotted black;
      padding: 0.5em;
      margin: 1em;
    }

    @media print {
      div.syntaxmenu {
        display: none;
      }
    }
  </style>
  <style id="respec-mainstyle">
    /*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/
    /* Override code highlighter background */

    .hljs {
      background: transparent !important;
    }
    /* --- INLINES --- */

    em.rfc2119 {
      text-transform: lowercase;
      font-style: normal;
      color: #900;
    }

    h1 abbr,
    h2 abbr,
    h3 abbr,
    h4 abbr,
    h5 abbr,
    h6 abbr,
    a abbr {
      border: none;
    }

    dfn {
      font-weight: bold;
    }

    a.internalDFN {
      color: inherit;
      border-bottom: 1px solid #99c;
      text-decoration: none;
    }

    a.externalDFN {
      color: inherit;
      border-bottom: 1px dotted #ccc;
      text-decoration: none;
    }

    a.bibref {
      text-decoration: none;
    }

    cite .bibref {
      font-style: normal;
    }

    code {
      color: #C83500;
    }

    th code {
      color: inherit;
    }
    /* --- TOC --- */

    .toc a,
    .tof a {
      text-decoration: none;
    }

    a .secno,
    a .figno {
      color: #000;
    }

    ul.tof,
    ol.tof {
      list-style: none outside none;
    }

    .caption {
      margin-top: 0.5em;
      font-style: italic;
    }
    /* --- TABLE --- */

    table.simple {
      border-spacing: 0;
      border-collapse: collapse;
      border-bottom: 3px solid #005a9c;
    }

    .simple th {
      background: #005a9c;
      color: #fff;
      padding: 3px 5px;
      text-align: left;
    }

    .simple th[scope="row"] {
      background: inherit;
      color: inherit;
      border-top: 1px solid #ddd;
    }

    .simple td {
      padding: 3px 10px;
      border-top: 1px solid #ddd;
    }

    .simple tr:nth-child(even) {
      background: #f0f6ff;
    }
    /* --- DL --- */

    .section dd>p:first-child {
      margin-top: 0;
    }

    .section dd>p:last-child {
      margin-bottom: 0;
    }

    .section dd {
      margin-bottom: 1em;
    }

    .section dl.attrs dd,
    .section dl.eldef dd {
      margin-bottom: 0;
    }

    #issue-summary>ul,
    .respec-dfn-list {
      column-count: 2;
    }

    #issue-summary li,
    .respec-dfn-list li {
      list-style: none;
    }

    @media print {
      .removeOnSave {
        display: none;
      }
    }
  </style>
  <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-WG-NOTE.css">
  <link rel="canonical" href="https://www.w3.org/TR/shacl-js/">
  <meta name="generator" content="ReSpec 13.1.0">
  <script id="initialUserConfig" type="application/json">
    {
      "localBiblio":
      {
        "shacl-af":
        {
          "title": "SHACL Advanced Features",
          "authors": [
            "Holger Knublauch",
            "Dean Allemang",
            "Simon Steyskal"
          ],
          "href": "https://www.w3.org/TR/shacl-af/",
          "status": "WG-NOTE",
          "publisher": "W3C"
        }
      },
      "edDraftURI": "https://w3c.github.io/data-shapes/shacl-js/",
      "issueBase": "http://www.w3.org/2014/data-shapes/track/issues/",
      "specStatus": "FPWD-NOTE",
      "preProcess": [
        null
      ],
      "shortName": "shacl-js",
      "editors": [
      {
        "name": "Holger Knublauch",
        "url": "http://knublauch.com/",
        "company": "TopQuadrant, Inc.",
        "companyURL": "http://topquadrant.com/",
        "w3cid": 46500
      },
      {
        "name": "Pano Maria",
        "company": "Taxonic",
        "companyURL": "http://taxonic.com"
      }],
      "publishDate": "2017-06-08",
      "wg": "RDF Data Shapes Working Group",
      "wgURI": "https://www.w3.org/2014/data-shapes/",
      "wgPublicList": "public-rdf-shapes",
      "wgPatentURI": "https://www.w3.org/2004/01/pp-impl/73865/status",
      "noHighlightCSS": true
    }
  </script>
</head>
<body aria-busy="false" class="h-entry toc-inline" id="respecDocument">
  <div class="head" role="contentinfo" id="respecHeader">
    <p>
      <a class="logo" href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" alt="W3C" width="72" height="48"></a>
    </p>
    <h1 class="title p-name" id="title" property="dcterms:title">SHACL JavaScript Extensions</h1>
    <h2 id="w3c-working-group-note-08-june-2017"><abbr title="World Wide Web Consortium">W3C</abbr> Working Group Note <time property="dcterms:issued" class="dt-published" datetime="2017-06-08">08 June 2017</time></h2>
    <dl>
      <dt>This version:</dt>
      <dd><a class="u-url" href="https://www.w3.org/TR/2017/NOTE-shacl-js-20170608/">https://www.w3.org/TR/2017/NOTE-shacl-js-20170608/</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="https://www.w3.org/TR/shacl-js/">https://www.w3.org/TR/shacl-js/</a></dd>
      <dt>Latest editor's draft:</dt>
      <dd><a href="https://w3c.github.io/data-shapes/shacl-js/">https://w3c.github.io/data-shapes/shacl-js/</a></dd>
      <dt>Editors:</dt>
      <dd class="p-author h-card vcard" property="bibo:editor" resource="_:editor0" data-editor-id="46500"><span property="rdf:first" typeof="foaf:Person"><meta property="foaf:name" content="Holger Knublauch"><a class="u-url url p-name fn" property="foaf:homepage" href="http://knublauch.com/">Holger Knublauch</a>, <a property="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://topquadrant.com/">TopQuadrant, Inc.</a></span>
        <span property="rdf:rest" resource="_:editor1"></span>
      </dd>
      <dd class="p-author h-card vcard" resource="_:editor1" data-editor-id="46500"><span property="rdf:first" typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Pano Maria</span>, <a property="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://taxonic.com">Taxonic</a></span>
        <span property="rdf:rest" resource="rdf:nil"></span>
      </dd>

    </dl>
    <p class="copyright">
      <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2017

      <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
      <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
      <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>).
      <abbr title="World Wide Web Consortium">W3C</abbr> <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
      <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
      <a rel="license" href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
    </p>
    <hr title="Separator for header">
  </div>

  <section id="abstract" class="introductory" property="dc:abstract">
    <h2 id="h-abstract" resource="#h-abstract"><span property="xhv:role" resource="xhv:heading">Abstract</span></h2>
    <p>
      This document defines a JavaScript-based extension mechanism for the Shapes Constraint Language (SHACL). It defines a syntax for declaring constraints, constraint components, functions, rules and targets in JavaScript. Using this syntax, SHACL shapes can benefit from the rich expressive power of JavaScript. In order to ensure that the resulting JavaScript code can be executed across platforms, this document defines a (minimalistic) JavaScript API that needs to be implemented by supporting engines.
    </p>
  </section>

  <section id="sotd" class="introductory">
    <h2 id="h-sotd" resource="#h-sotd"><span property="xhv:role" resource="xhv:heading">Status of This Document</span></h2>
    <p>
      <em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em>
    </p>

    <p>
      Future revisions of this document may be produced by a SHACL <abbr title="World Wide Web Consortium">W3C</abbr> Community Group.
    </p>

    <p>
      This document was published by the <a href="https://www.w3.org/2014/data-shapes/">RDF Data Shapes Working Group</a> as a First Public Working Group Note. Comments regarding this document are welcome. Please send them to
      <a href="mailto:public-rdf-shapes@w3.org">public-rdf-shapes@w3.org</a> (<a href="mailto:public-rdf-shapes-request@w3.org?subject=subscribe">subscribe</a>,
      <a href="https://lists.w3.org/Archives/Public/public-rdf-shapes/">archives</a>).
    </p>
    <p>
      Publication as a Working Group Note does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.
    </p>
    <p>
      This document was produced by a group operating under the
      <a id="sotd_patent" property="w3p:patentRules" href="https://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent
            Policy</a>.
      <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="https://www.w3.org/2004/01/pp-impl/73865/status" rel="disclosure">public list of any patent
              disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains
      <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
            Claim(s)</a> must disclose the information in accordance with
      <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
    </p>
    <p>This document is governed by the <a id="w3c_process_revision" href="https://www.w3.org/2017/Process-20170301/">1 March 2017 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
    </p>


  </section>
  <nav id="toc">
    <h2 class="introductory" id="table-of-contents" resource="#table-of-contents"><span property="xhv:role" resource="xhv:heading">Table of Contents</span></h2>
    <ol class="toc" role="directory">
      <li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">1. </span>Introduction</a></li>
      <li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">2. </span>Conformance</a></li>
      <li class="tocline"><a href="#js-api" class="tocxref"><span class="secno">3. </span>JavaScript API for RDF</a>
        <ol class="toc">
          <li class="tocline"><a href="#js-api-terms" class="tocxref"><span class="secno">3.1 </span>RDF Terms</a>
            <ol class="toc">
              <li class="tocline"><a href="#js-api-iri" class="tocxref"><span class="secno">3.1.1 </span>IRIs / Named Nodes</a></li>
              <li class="tocline"><a href="#js-api-bnode" class="tocxref"><span class="secno">3.1.2 </span>Blank Nodes</a></li>
              <li class="tocline"><a href="#js-api-literals" class="tocxref"><span class="secno">3.1.3 </span>Literals</a></li>
              <li class="tocline"><a href="#js-api-termfactory" class="tocxref"><span class="secno">3.1.4 </span>The TermFactory</a></li>
            </ol>
          </li>
          <li class="tocline"><a href="#js-api-triples" class="tocxref"><span class="secno">3.2 </span>Triples</a></li>
          <li class="tocline"><a href="#js-api-graphs" class="tocxref"><span class="secno">3.3 </span>Graphs</a>
            <ol class="toc">
              <li class="tocline"><a href="#dataGraph" class="tocxref"><span class="secno">3.3.1 </span>Accessing the Data Graph via $data</a></li>
              <li class="tocline"><a href="#shapesGraph" class="tocxref"><span class="secno">3.3.2 </span>Accessing the Shapes Graph via $shapes</a></li>
              <li class="tocline"><a href="#asynch" class="tocxref"><span class="secno">3.3.3 </span>Synchronous versus Asynchronous Queries</a></li>
            </ol>
          </li>
          <li class="tocline"><a href="#js-validate" class="tocxref"><span class="secno">3.4 </span>Validating Nodes via JavaScript</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#js-rdf" class="tocxref"><span class="secno">4. </span>Representing JavaScript in RDF</a>
        <ol class="toc">
          <li class="tocline"><a href="#jsFunctionName" class="tocxref"><span class="secno">4.1 </span>sh:jsFunctionName</a></li>
          <li class="tocline"><a href="#jsLibrary" class="tocxref"><span class="secno">4.2 </span>sh:jsLibrary</a></li>
          <li class="tocline"><a href="#JSLibrary" class="tocxref"><span class="secno">4.3 </span>sh:JSLibrary</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#js-exec" class="tocxref"><span class="secno">5. </span>Executing JavaScript</a></li>
      <li class="tocline"><a href="#js-constraints" class="tocxref"><span class="secno">6. </span>JavaScript-based Constraints</a>
        <ol class="toc">
          <li class="tocline"><a href="#js-constraints-example" class="tocxref"><span class="secno">6.1 </span>An Example JavaScript-based Constraint</a></li>
          <li class="tocline"><a href="#js-constraints-validation" class="tocxref"><span class="secno">6.2 </span>Validation with JavaScript-based Constraints</a></li>
          <li class="tocline"><a href="#js-constraints-results" class="tocxref"><span class="secno">6.3 </span>Mapping of JavaScript Results to Result Properties</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#js-components" class="tocxref"><span class="secno">7. </span>JavaScript-based Constraint Components</a>
        <ol class="toc">
          <li class="tocline"><a href="#an-example-javascript-based-constraint-component" class="tocxref"><span class="secno">7.1 </span>An Example JavaScript-based Constraint Component</a></li>
          <li class="tocline"><a href="#syntax-of-javascript-based-constraint-components" class="tocxref"><span class="secno">7.2 </span>Syntax of JavaScript-based Constraint Components</a></li>
          <li class="tocline"><a href="#validation-of-javascript-based-constraint-components" class="tocxref"><span class="secno">7.3 </span>Validation of JavaScript-based Constraint Components</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#js-functions" class="tocxref"><span class="secno">8. </span>JavaScript-based Functions</a>
        <ol class="toc">
          <li class="tocline"><a href="#an-example-javascript-based-function" class="tocxref"><span class="secno">8.1 </span>An Example JavaScript-based Function</a></li>
          <li class="tocline"><a href="#syntax-and-semantics-of-javascript-based-functions" class="tocxref"><span class="secno">8.2 </span>Syntax and Semantics of JavaScript-based Functions</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#rules" class="tocxref"><span class="secno">9. </span>JavaScript Rules</a>
        <ol class="toc">
          <li class="tocline"><a href="#rules-example" class="tocxref"><span class="secno">9.1 </span>An Example JavaScript Rule</a></li>
          <li class="tocline"><a href="#rules-execution" class="tocxref"><span class="secno">9.2 </span>Execution Instructions for JavaScript Rules</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#targets" class="tocxref"><span class="secno">10. </span>JavaScript-based Custom Targets</a>
        <ol class="toc">
          <li class="tocline"><a href="#JSTarget" class="tocxref"><span class="secno">10.1 </span>JavaScript-based Targets (sh:JSTarget)</a></li>
          <li class="tocline"><a href="#JSTargetType" class="tocxref"><span class="secno">10.2 </span>JavaScript-based Target Types (sh:JSTargetType)</a></li>
        </ol>
      </li>
      <li class="tocline"><a href="#syntax-rules" class="tocxref"><span class="secno">A. </span>Summary of SHACL-JS Syntax Rules</a></li>
      <li class="tocline"><a href="#security" class="tocxref"><span class="secno">B. </span>Security and Privacy Considerations</a></li>
      <li class="tocline"><a href="#references" class="tocxref"><span class="secno">C. </span>References</a>
        <ol class="toc">
          <li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">C.1 </span>Normative references</a></li>
          <li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">C.2 </span>Informative references</a></li>
        </ol>
      </li>
    </ol>
  </nav>

  <section class="introductory" typeof="bibo:Chapter" resource="#document-conventions" property="bibo:hasPart">
    <h2 id="document-conventions" resource="#document-conventions"><span property="xhv:role" resource="xhv:heading">Document Conventions</span></h2>
    <p>
      Some examples in this document use Turtle [<cite><a class="bibref" href="#bib-turtle">turtle</a></cite>]. The reader is expected to be familiar with SHACL [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>] and the SHACL Advanced Features [<cite><a class="bibref" href="#bib-shacl-af">shacl-af</a></cite>].
    </p>
    <p>
      Within this document, the following namespace prefix bindings are used:
    </p>
    <table class="term-table">
      <tbody>
        <tr>
          <th>Prefix</th>
          <th>Namespace</th>
        </tr>
        <tr>
          <td><code>rdf:</code></td>
          <td><code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code></td>
        </tr>
        <tr>
          <td><code>rdfs:</code></td>
          <td><code>http://www.w3.org/2000/01/rdf-schema#</code></td>
        </tr>
        <tr>
          <td><code>sh:</code></td>
          <td><code>http://www.w3.org/ns/shacl#</code></td>
        </tr>
        <tr>
          <td><code>xsd:</code></td>
          <td><code>http://www.w3.org/2001/XMLSchema#</code></td>
        </tr>
        <tr>
          <td><code>ex:</code></td>
          <td><code>http://example.com/ns#</code></td>
        </tr>
      </tbody>
    </table>
    <p>
      Throughout the document, color-coded boxes containing RDF graphs in Turtle will appear. These fragments of Turtle documents use the prefix bindings given above.
    </p>
    <pre class="example-shapes"># This box represents a shapes graph
&lt;s&gt; &lt;p&gt; &lt;o&gt; .</pre>

    <pre class="example-js">// This box contains JavaScript code</pre>

    <pre class="example-data"># This box represents a data graph.</pre>

    <pre class="example-results"># This box represents an output results graph</pre>

    <p>
      Formal definitions appear in blue boxes:
    </p>
    <div class="def def-sparql">
      <div class="def-header">TEXTUAL DEFINITIONS</div>
      <pre class="def-sparql-body"># This box contains textual definitions. </pre>
    </div>

    <p class="syntax">
      Grey boxes such as this include syntax rules that apply to the shapes graph.
    </p>

    <p>
      <code>true</code> denotes the RDF term <code>"true"^^xsd:boolean</code>.
      <code>false</code> denotes the RDF term <code>"false"^^xsd:boolean</code>.
    </p>
  </section>

  <section class="introductory" typeof="bibo:Chapter" resource="#terminology" property="bibo:hasPart">
    <h2 id="terminology" resource="#terminology"><span property="xhv:role" resource="xhv:heading">Terminology</span></h2>
    <p>
      The terminology used throughout this document is consistent with the definitions in the main SHACL [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>] specification, which references terms from RDF [<cite><a class="bibref" href="#bib-rdf11-concepts">rdf11-concepts</a></cite>]. This includes the terms
      <dfn data-dfn-type="dfn" id="dfn-blank-node"><a href="https://www.w3.org/TR/shacl/#dfn-blank-node">blank node</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-conformance"><a href="https://www.w3.org/TR/shacl/#dfn-conforms">conformance</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-constraint"><a href="https://www.w3.org/TR/shacl/#dfn-constraint">constraint</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-constraint-component"><a href="https://www.w3.org/TR/shacl/#dfn-constraint-component">constraint component</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-data-graph"><a href="https://www.w3.org/TR/shacl/#dfn-data-graph">data graph</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-datatype"><a href="https://www.w3.org/TR/shacl/#dfn-datatype">datatype</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-failure"><a href="https://www.w3.org/TR/shacl/#dfn-failure">failure</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-focus-node"><a href="https://www.w3.org/TR/shacl/#dfn-focus-node">focus node</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-rdf-graph"><a href="https://www.w3.org/TR/shacl/#dfn-rdf-graph">RDF graph</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-ill-formed"><a href="https://www.w3.org/TR/shacl/#dfn-ill-formed">ill-formed</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-iri"><a href="https://www.w3.org/TR/shacl/#dfn-iri">IRI</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-literal"><a href="https://www.w3.org/TR/shacl/#dfn-literal">literal</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-local-name"><a href="https://www.w3.org/TR/shacl/#dfn-local-name">local name</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-node"><a href="https://www.w3.org/TR/shacl/#dfn-node">node</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-node-shape"><a href="https://www.w3.org/TR/shacl/#dfn-node-shape">node shape</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-object"><a href="https://www.w3.org/TR/shacl/#dfn-object">object</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-parameter"><a href="https://www.w3.org/TR/shacl/#dfn-parameters">parameter</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-predicate"><a href="https://www.w3.org/TR/shacl/#dfn-predicate">predicate</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-property-shape"><a href="https://www.w3.org/TR/shacl/#dfn-property-shape">property shape</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-rdf-term"><a href="https://www.w3.org/TR/shacl/#dfn-rdf-term">RDF term</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-shacl-instance"><a href="https://www.w3.org/TR/shacl/#dfn-shacl-instance">SHACL instance</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-shape"><a href="https://www.w3.org/TR/shacl/#dfn-shape">shape</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-shapes-graph"><a href="https://www.w3.org/TR/shacl/#dfn-shapes-graph">shapes graph</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-subject"><a href="https://www.w3.org/TR/shacl/#dfn-subject">subject</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-target"><a href="https://www.w3.org/TR/shacl/#dfn-target">target</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-triple"><a href="https://www.w3.org/TR/shacl/#dfn-rdf-triple">triple</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-validation"><a href="https://www.w3.org/TR/shacl/#dfn-validation">validation</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-validation-report"><a href="https://www.w3.org/TR/shacl/#dfn-validation-report">validation report</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-validation-result"><a href="https://www.w3.org/TR/shacl/#dfn-validation-results">validation result</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-validator"><a href="https://www.w3.org/TR/shacl/#dfn-validators">validator</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-value"><a href="https://www.w3.org/TR/shacl/#dfn-value">value</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-value-node"><a href="https://www.w3.org/TR/shacl/#dfn-value-nodes">value node</a></dfn>. Additional terms are defined in the SHACL Advanced Features document [<cite><a class="bibref" href="#bib-shacl-af">shacl-af</a></cite>]:
      <dfn data-dfn-type="dfn" id="dfn-custom-target"><a href="https://www.w3.org/TR/shacl-af/#dfn-target">custom target</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-rule-type"><a href="https://www.w3.org/TR/shacl-af/#dfn-rule-type">rule type</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-rule"><a href="https://www.w3.org/TR/shacl-af/#dfn-shacl-rules">rule</a></dfn>,
      <dfn data-dfn-type="dfn" id="dfn-shacl-function"><a href="https://www.w3.org/TR/shacl-af/#dfn-shacl-functions">SHACL function</a></dfn>.
    </p>
  </section>

  <section id="introduction" typeof="bibo:Chapter" resource="#introduction" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-introduction" resource="#h-introduction"><span property="xhv:role" resource="xhv:heading"><span class="secno">1. </span>Introduction</span>
    </h2>
    <p>
      The Shapes Constraint Language (SHACL) [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>] is a language for validating <a href="#dfn-rdf-graph" class="internalDFN" data-link-type="dfn">RDF graphs</a> against a set of conditions. These conditions are provided as <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shapes</a> and other constructs expressed in the form of an RDF graph. SHACL is represented in RDF and consists of a SHACL Core RDF vocabulary with terms such as <code>sh:minCount</code> to express the most frequently needed <a href="#dfn-constraint" class="internalDFN" data-link-type="dfn">constraint</a> kinds. However, in order to express more complex constraints, the SHACL Core vocabulary is often not sufficient. SHACL-SPARQL [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>] is one extension mechanism for SHACL to express constraints in SPARQL, allowing shape definitions to point at executable SPARQL [<cite><a class="bibref" href="#bib-sparql11-query">sparql11-query</a></cite>] queries to perform the validation checks. This document defines the <dfn data-dfn-type="dfn" id="dfn-shacl-javascript-extensions-shacl-js">SHACL JavaScript Extensions (SHACL-JS)</dfn>, allowing users to express SHACL constraints and the advanced features of custom targets, functions and rules with the help of JavaScript.
    </p>
    <p>
      SHACL-JS is based on a similar design to SHACL-SPARQL, but for JavaScript instead of SPARQL. The basic idea is that SHACL shapes can point at JavaScript functions in specified JavaScript files that can be resolved from the web. When shapes get evaluated, a SHACL-JS engine calls those functions with a predefined set of arguments and constructs validation results from the values and objects returned by these JavaScript function calls. The JavaScript code can access RDF triples from both the <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a> and the <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a> where needed, through the <a href="#js-api">JavaScript API</a> that is defined in this document, or a higher-level JavaScript API that uses the specified API under the hood.
    </p>
    <p>
      As a result of this design, SHACL shape definitions can be augmented with JavaScript and executed either within web browsers (assuming the SHACL engine operates on the client), or on servers that support JavaScript execution.
    </p>
  </section>

  <section id="conformance" typeof="bibo:Chapter" resource="#conformance" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-conformance" resource="#h-conformance"><span property="xhv:role" resource="xhv:heading"><span class="secno">2. </span>Conformance</span>
    </h2>
    <p>
      As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.
    </p>
    <p id="respecRFC2119">The key words <em class="rfc2119">MUST</em> and <em class="rfc2119">MUST NOT</em> are to be interpreted as described in [<cite><a class="bibref" href="#bib-RFC2119">RFC2119</a></cite>].
    </p>

  </section>

  <section id="js-api" typeof="bibo:Chapter" resource="#js-api" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-js-api" resource="#h-js-api"><span property="xhv:role" resource="xhv:heading"><span class="secno">3. </span>JavaScript API for RDF</span>
    </h2>
    <p>
      This section defines an API that JavaScript-based SHACL functions can use to operate on
      <a href="#js-api-terms">RDF terms</a> and to query <a href="#js-api-triples">triples</a> in <a href="#js-api-graphs">graphs</a>. The JavaScript code behind SHACL-JS <a href="#dfn-constraint" class="internalDFN" data-link-type="dfn">constraints</a> and <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint components</a> can directly access those functions or go through a higher-level layer of convenience functions that use these functions under the hood.
    </p>
    <p>
      Note that the API expects these JavaScript Objects to be immutable, i.e. neither the values of an <a href="#js-api-terms">RDF term</a> nor <a href="#js-api-triples">triples</a> nor
      <a href="#js-api-graphs">graphs</a> can be modified during SHACL <a href="#dfn-validation" class="internalDFN" data-link-type="dfn">validation</a>.
    </p>

    <section id="js-api-terms" typeof="bibo:Chapter" resource="#js-api-terms" property="bibo:hasPart">
      <h3 id="h-js-api-terms" resource="#h-js-api-terms"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.1 </span>RDF Terms</span>
      </h3>
      <p>
        All <a href="#dfn-rdf-term" class="internalDFN" data-link-type="dfn">RDF terms</a> (<a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRIs</a>, <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn">blank nodes</a> and <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literals</a>) are represented using JavaScript Objects that have attributes as described in the following three subsections. The following table summarizes key functions to create and operate on RDF term Objects:
      </p>
      <table class="term-table">
        <tbody>
          <tr>
            <th>Node Kind</th>
            <th>Factory Function</th>
            <th>Test Function</th>
            <th>Attributes</th>
          </tr>
          <tr>
            <td>IRIs</td>
            <td><code>TermFactory.namedNode(uri)</code></td>
            <td><code>.isURI()</code></td>
            <td><code>uri</code></td>
          </tr>
          <tr>
            <td>Blank Nodes</td>
            <td><code>TermFactory.blankNode(id)</code> or <code>TermFactory.blankNode()</code></td>
            <td><code>.isBlankNode()</code></td>
            <td><code>id</code></td>
          </tr>
          <tr>
            <td>Literals</td>
            <td><code>TermFactory.literal(lex, languageOrDatatype)</code></td>
            <td><code>.isLiteral()</code></td>
            <td><code>datatype</code>, <code>language</code>, <code>lex</code></td>
          </tr>
        </tbody>
      </table>
      <p>
        Note that the attributes in the table above are only defined for Objects that have matching types. For example, the result of querying the <code>uri</code> of a <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn">blank node</a> is undefined.
      </p>
      <p>
        Each of these Objects must have a function <code>.equals(other)</code> that takes another term Object as its only parameter and returns <code>true</code> exactly if the underlying <a href="#dfn-rdf-term" class="internalDFN" data-link-type="dfn">RDF terms</a> are equal, and <code>false</code> otherwise.
      </p>

      <section id="js-api-iri" typeof="bibo:Chapter" resource="#js-api-iri" property="bibo:hasPart">
        <h4 id="h-js-api-iri" resource="#h-js-api-iri"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.1.1 </span>IRIs / Named Nodes</span>
        </h4>
        <p>
          An <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRI</a> is represented by a JavaScript <code>NamedNode</code> Object where <code>.isURI()</code> returns <code>true</code> while <code>.isBlankNode()</code> and <code>.isLiteral()</code> return <code>false</code>. The value of the read-only attribute <code>uri</code> is the <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRI</a> string.
        </p>
      </section>

      <section id="js-api-bnode" typeof="bibo:Chapter" resource="#js-api-bnode" property="bibo:hasPart">
        <h4 id="h-js-api-bnode" resource="#h-js-api-bnode"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.1.2 </span>Blank Nodes</span>
        </h4>
        <p>
          A <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn">blank node</a> is represented by a JavaScript <code>BlankNode</code> Object where <code>.isBlankNode()</code> returns <code>true</code> while <code>.isURI()</code> and <code>.isLiteral()</code> return <code>false</code>. The value of the read-only attribute <code>id</code> is the blank node identifier as a string. That string is must be consistent for the same RDF node for the duration of a SHACL validation and processing of validation results.
        </p>
      </section>

      <section id="js-api-literals" typeof="bibo:Chapter" resource="#js-api-literals" property="bibo:hasPart">
        <h4 id="h-js-api-literals" resource="#h-js-api-literals"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.1.3 </span>Literals</span>
        </h4>
        <p>
          A <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> is represented by a JavaScript <code>Literal</code> Object where <code>.isLiteral()</code> returns <code>true</code> while <code>.isURI()</code> and <code>.isBlankNode()</code> return <code>false</code>. The value of the read-only attribute <code>language</code> is a lowercase BCP-47 [<cite><a class="bibref" href="#bib-BCP47">BCP47</a></cite>] string (for example, <code>en</code>, <code>en-gb</code>), or an empty string if the literal has no language. The value of the read-only attribute <code>datatype</code> is a <a href="#js-api-iri">NamedNode</a> representing the datatype IRI of the literal. Note that this <code>datatype</code> is never undefined, and language-tagged strings have <code>rdf:langString</code> as their datatype. The value of the read-only attribute <code>lex</code> is the lexical form of the literal, e.g. <code>"042"</code> for the RDF node <code>"042"^^xsd:integer</code>.
        </p>
      </section>

      <section id="js-api-termfactory" typeof="bibo:Chapter" resource="#js-api-termfactory" property="bibo:hasPart">
        <h4 id="h-js-api-termfactory" resource="#h-js-api-termfactory"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.1.4 </span>The TermFactory</span>
        </h4>
        <p>
          During the execution of JavaScript code, the SHACL engine <em class="rfc2119" title="MUST">MUST</em> provide an Object accessible via the variable <code>TermFactory</code> that can be used to create JavaScript Objects for RDF terms. The <code>TermFactory</code> provides the following three functions:
        </p>
        <ul>
          <li>
            <code>namedNode(uri)</code> returns a <a href="#js-api-iri">NamedNode</a> with the
            <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRI</a> provided as a string via <code>uri</code>.
          </li>
          <li>
            <code>blankNode(id)</code> returns a <a href="#js-api-bnode">BlankNode</a> with an optional identifier provided as a string via <code>id</code>. If the <code>id</code> is omitted then the system generates a unique identifier.
          </li>
          <li>
            <code>literal(lex, languageOrDatatype)</code> returns a <a href="#js-api-literals">Literal</a> with the lexical form provided as a string via <code>lex</code>. The second argument <code>languageOrDatatype</code> must be either a non-empty string, in which case the literal will have that value as its language tag, or a JavaScript <a href="#js-api-iri">NamedNode</a> Object representing a datatype other than
            <code>rdf:langString</code>.
          </li>
        </ul>
      </section>
    </section>

    <section id="js-api-triples" typeof="bibo:Chapter" resource="#js-api-triples" property="bibo:hasPart">
      <h3 id="h-js-api-triples" resource="#h-js-api-triples"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.2 </span>Triples</span>
      </h3>
      <p>
        An RDF <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> is represented by a JavaScript <code>Triple</code> Object with three read-only attributes <code>subject</code>, <code>predicate</code> and <code>object</code>, each of which has exactly one RDF term as its value. Furthermore, triples must provide an <code>equals</code> function that takes an Object <code>other</code> as its only parameter and returns a boolean.
        <code>equals</code> returns <code>true</code> exactly if <code>other</code> has values for its attributes <code>subject</code>, <code>predicate</code> and <code>object</code> that return <code>true</code> when compared using <code>equals()</code> against the corresponding attribute values of the first triple, and <code>false</code> otherwise.
      </p>
    </section>

    <section id="js-api-graphs" typeof="bibo:Chapter" resource="#js-api-graphs" property="bibo:hasPart">
      <h3 id="h-js-api-graphs" resource="#h-js-api-graphs"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.3 </span>Graphs</span>
      </h3>
      <p>
        An RDF graph is represented by a JavaScript <code>Graph</code> Object that has a function <code>find</code> which takes three parameters of type Object, all of which are optional. The result of the <code>find</code> function is an <dfn data-dfn-type="dfn" id="dfn-iterator">Iterator</dfn> object with two functions:
      </p>
      <ul>
        <li>
          <code>next()</code> either returns a <code>Triple</code> or <code>null</code> if the iteration has been exhausted.
        </li>
        <li>
          <code>close()</code> terminates the <a href="#dfn-iterator" class="internalDFN" data-link-type="dfn">Iterator</a> and releases any resources allocated by it. Once <code>close()</code> has been called, further calls to <code>next()</code> cause an exception. The <code>close()</code> function <em class="rfc2119" title="MUST">MUST</em> always be called unless the iterator has already been walked to completion.
        </li>
      </ul>
      <p>
        The following JavaScript snippet assumes that the current <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a> is represented by the variable <code>$data</code> and gets the first label of a given resource where the label is an english literal.
      </p>
      <pre class="example-js">function getEnglishLabel(resource) {
	var labelProperty = TermFactory.namedNode("http://www.w3.org/2000/01/rdf-schema#label");
	var labels = $data.find(resource, labelProperty, null);
	for(;;) {
		var labelTriple = labels.next();
		if(!labelTriple) {
			return null;
		}
		var label = labelTriple.object;
		if(label.isLiteral() &amp;&amp; label.language.startsWith("en")) {
			labels.close();
			return label.value;
		}
	}
}</pre>

      <section id="dataGraph" typeof="bibo:Chapter" resource="#dataGraph" property="bibo:hasPart">
        <h4 id="h-datagraph" resource="#h-datagraph"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.3.1 </span>Accessing the Data Graph via $data</span>
        </h4>
        <p>
          During a <a href="#dfn-validation" class="internalDFN" data-link-type="dfn">validation</a> process, the variable <code>$data</code> points at the JavaScript <a href="#js-api-graphs"><code>Graph</code></a> Object representing the SHACL <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a>.
        </p>
      </section>

      <section id="shapesGraph" typeof="bibo:Chapter" resource="#shapesGraph" property="bibo:hasPart">
        <h4 id="h-shapesgraph" resource="#h-shapesgraph"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.3.2 </span>Accessing the Shapes Graph via $shapes</span>
        </h4>
        <p>
          During a validation process, the variable <code>$shapes</code> points at the JavaScript <a href="#js-api-graphs">Graph</a> Object representing the SHACL <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a>. This may be identical to the <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a>.
        </p>
      </section>

      <section id="asynch" class="informative" typeof="bibo:Chapter" resource="#asynch" property="bibo:hasPart">
        <h4 id="h-asynch" resource="#h-asynch"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.3.3 </span>Synchronous versus Asynchronous Queries</span>
        </h4>
        <p><em>This section is non-normative.</em></p>
        <p>
          The iterators produced by the <code>find</code> function described in this section are expected to be operating synchronously, i.e. the triples are available immediately to the caller. Since many of the constraints that users want to express in SHACL can be quite complex, a synchronous API contract typically leads to more maintainable code than an asynchronous one (with callbacks or promises). If data needs to be loaded on demand from a remote server, then solutions such as pre-caching or the <code>await</code> keyword may be used as a work-around. More sophisticated handling of asynchronous query scenarios may be defined by future versions of SHACL-JS.
        </p>
      </section>
    </section>

    <section id="js-validate" typeof="bibo:Chapter" resource="#js-validate" property="bibo:hasPart">
      <h3 id="h-js-validate" resource="#h-js-validate"><span property="xhv:role" resource="xhv:heading"><span class="secno">3.4 </span>Validating Nodes via JavaScript</span>
      </h3>
      <p>
        SHACL-JS processors must provide a JavaScript function with the following signature:
      </p>
      <code>SHACL.nodeConformsToShape(node, shape)</code>
      <ol>
        <li><code>node</code>: The <a href="#js-api-terms">RDF term Object</a> of the <a href="#dfn-node" class="internalDFN" data-link-type="dfn">node</a> to validate</li>
        <li><code>shape</code>: The <a href="#js-api-terms">RDF term Object</a> of the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> to validate the <a href="#dfn-node" class="internalDFN" data-link-type="dfn">node</a> against</li>
      </ol>
      <p>
        The result of this function is <code>true</code> if and only if <code>node</code> <a href="#dfn-conformance" class="internalDFN" data-link-type="dfn">conforms</a> to the <code>shape</code>, and <code>false</code> otherwise.
      </p>
      <p>
        This function is needed because the implementation of some of the <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint components</a> such as <code>sh:NotConstraintComponent</code> requires the ability to spawn off a new SHACL validation process. It may also be used as entry point into the validation engine by custom code.
      </p>
    </section>
  </section>

  <section id="js-rdf" typeof="bibo:Chapter" resource="#js-rdf" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-js-rdf" resource="#h-js-rdf"><span property="xhv:role" resource="xhv:heading"><span class="secno">4. </span>Representing JavaScript in RDF</span>
    </h2>
    <p>
      This section defines some general <a href="#dfn-rdf-term" class="internalDFN" data-link-type="dfn">RDF terms</a> used by SHACL-JS to represent JavaScript code and libraries as part of a declarative <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a>.
    </p>
    <p>
      The SHACL-JS vocabulary includes the class <code>sh:JSExecutable</code>. SHACL instances of this class are called <dfn data-dfn-type="dfn" id="dfn-javascript-executables">JavaScript executables</dfn> and may have values for the properties <code>sh:jsFunctionName</code> and <code>sh:jsLibrary</code>.
    </p>

    <section id="jsFunctionName" typeof="bibo:Chapter" resource="#jsFunctionName" property="bibo:hasPart">
      <h3 id="h-jsfunctionname" resource="#h-jsfunctionname"><span property="xhv:role" resource="xhv:heading"><span class="secno">4.1 </span>sh:jsFunctionName</span>
      </h3>
      <p class="syntax">
        <span data-syntax-rule="jsFunctionName-count" id="syntax-rule-jsFunctionName-count">Every <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> must have exactly one <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> for the property <code>sh:jsFunctionName</code>.</span>
        <span data-syntax-rule="jsFunctionName-datatype" id="syntax-rule-jsFunctionName-datatype">The values of <code>sh:jsFunctionName</code> are <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literals</a> with <a href="#dfn-datatype" class="internalDFN" data-link-type="dfn">datatype</a> <code>xsd:string</code>.</span>
      </p>
      <p>
        The semantics of how arguments are passed into the provided function depend on the specific type of executable, as described in later sections.
      </p>
    </section>

    <section id="jsLibrary" typeof="bibo:Chapter" resource="#jsLibrary" property="bibo:hasPart">
      <h3 id="h-jslibrary" resource="#h-jslibrary"><span property="xhv:role" resource="xhv:heading"><span class="secno">4.2 </span>sh:jsLibrary</span>
      </h3>
      <p class="syntax">
        <span data-syntax-rule="jsLibrary-minCount" id="syntax-rule-jsLibrary-minCount">Every <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> must have at least one <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> for the property <code>sh:jsLibrary</code>.</span>
        <span data-syntax-rule="jsLibrary-nodeKind" id="syntax-rule-jsLibrary-nodeKind">The <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of the property <code>sh:jsLibrary</code> are <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRIs</a> or <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn">blank nodes</a>.</span>
        <span data-syntax-rule="jsLibrary-class" id="syntax-rule-jsLibrary-class">The <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of the property <code>sh:jsLibrary</code> are well-formed SHACL instances of the class <code>sh:JSLibrary</code>.</span>
      </p>
    </section>

    <section id="JSLibrary" typeof="bibo:Chapter" resource="#JSLibrary" property="bibo:hasPart">
      <h3 id="h-jslibrary-1" resource="#h-jslibrary-1"><span property="xhv:role" resource="xhv:heading"><span class="secno">4.3 </span>sh:JSLibrary</span>
      </h3>
      <p>
        The class <code>sh:JSLibrary</code> can be used to declare <dfn data-dfn-type="dfn" id="dfn-javascript-libraries">JavaScript libraries</dfn>. A library can be understood as a pointer to zero or more JavaScript files that need to be executed before a <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> can be evaluated. Libraries may depend on each other by declaring further <code>sh:jsLibrary</code> triples.
      </p>
      <p class="syntax">
        <span data-syntax-rule="jsLibraryURL-datatype" id="syntax-rule-jsLibraryURL-datatype">The values of the property <code>sh:jsLibraryURL</code> are <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literals</a> with <a href="#dfn-datatype" class="internalDFN" data-link-type="dfn">datatype</a> <code>xsd:anyURI</code>.</span>
      </p>
    </section>
  </section>

  <section id="js-exec" typeof="bibo:Chapter" resource="#js-exec" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-js-exec" resource="#h-js-exec"><span property="xhv:role" resource="xhv:heading"><span class="secno">5. </span>Executing JavaScript</span>
    </h2>
    <p>
      This section defines general rules for the execution of JavaScript declared in RDF, by a SHACL engine.
    </p>

    <div class="def def-text">
      <div class="def-header">Execution of a JavaScript function</div>
      <div class="def-text-body" id="dfn-execution-of-a-javascript-function">
        Let <code>args</code> be a mapping of variable names to RDF nodes. The result of the <dfn data-dfn-type="dfn" id="dfn-execution-of-a-javascript-function-1">execution of a JavaScript function</dfn> using <code>args</code> is the result of the invocation of the JavaScript function, matching each variable name in <code>args</code> to parameter values in the function's signature. A JavaScript parameter matches a variable name if its name is equal to the concatenation of <code>"$"</code> and the variable name.
      </div>
    </div>

    <p>
      For the above definition, consider an example function <code>myFunction($arg1, $arg2, $arg3) { ... }</code> and a variable mapping <code>{ "arg1" : ex:Instance1, "arg2" : 42 }</code>. The JavaScript function would be called with the JavaScript <a href="#js-api-iri"><code>NamedNode</code></a> object representing <code>ex:Instance1</code> as value for <code>$arg1</code>, the JavaScript <a href="#js-api-literals"><code>Literal</code></a> object representing <code>42</code> as value for <code>$arg2</code>, and <code>undefined</code> as value for <code>$arg3</code>.
    </p>

    <div class="def def-text">
      <div class="def-header">Execution of a JavaScript executable</div>
      <div class="def-text-body" id="dfn-execution-of-a-javascript-executable">
        The <dfn data-dfn-type="dfn" id="dfn-execution-of-a-javascript-executable-1">execution of a <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a></dfn> consists of <em>executing</em> any <a href="#dfn-javascript-libraries" class="internalDFN" data-link-type="dfn">JavaScript libraries</a> that are <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of <code>sh:jsLibrary</code> (including the libraries referenced by those libraries), followed by the <a href="#dfn-execution-of-a-javascript-function">execution of the JavaScript function</a> that has the same name as the
        <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> of <code>sh:jsFunctionName</code>. The result of the latter is the result of executing the executable.
      </div>
    </div>

    <div class="def def-text">
      <div class="def-header">Execution of a JavaScript library</div>
      <div class="def-text-body">
        Within the same JavaScript engine, the same <a href="#dfn-javascript-libraries" class="internalDFN" data-link-type="dfn">JavaScript library</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be executed more than once. When a <a href="#dfn-javascript-libraries" class="internalDFN" data-link-type="dfn">JavaScript library</a> is executed, all its values for <code>sh:jsLibraryURL</code> must be resolved into JavaScript code. By default this resolution mechanism <em class="rfc2119" title="MUST">MUST</em> be performing an HTTP GET request against the given script URL. A <a href="#dfn-failure" class="internalDFN" data-link-type="dfn">failure</a> <em class="rfc2119" title="MUST">MUST</em> be reported if the SHACL processor encounters a cyclic dependency between libraries.
      </div>
    </div>
    <p>
      In practice, SHACL implementations may redirect the resolution of URLs to local files or cached copies.
    </p>
  </section>

  <section id="js-constraints" typeof="bibo:Chapter" resource="#js-constraints" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-js-constraints" resource="#h-js-constraints"><span property="xhv:role" resource="xhv:heading"><span class="secno">6. </span>JavaScript-based Constraints</span>
    </h2>
    <p>
      SHACL-JS supports constraints that can be used to express restrictions based on JavaScript. In a nutshell, whenever a SHACL validation engine encounters a <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> with a <code>sh:js</code> <a href="#dfn-constraint" class="internalDFN" data-link-type="dfn">constraint</a>, it will execute the provided JavaScript function and use the returned result to create <a href="#dfn-validation-result" class="internalDFN" data-link-type="dfn">validation results</a>.
    </p>
    <p>
      <span class="component-class">Constraint Component IRI</span>: <code>sh:JSConstraintComponent</code>
    </p>

    <div class="parameters">Parameters:</div>
    <table class="term-table">
      <tbody>
        <tr>
          <th>Property</th>
          <th>Summary</th>
        </tr>
        <tr>
          <td><code>sh:js</code></td>
          <td>A <a href="#dfn-javascript-based-constraints" class="internalDFN" data-link-type="dfn">JavaScript-based constraint</a> declaring the JavaScript function to evaluate.</td>
        </tr>
      </tbody>
    </table>
    <p>
      The <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of <code>sh:js</code> at a <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> are called <dfn data-dfn-type="dfn" id="dfn-javascript-based-constraints">JavaScript-based constraints</dfn>. Each JavaScript-based constraint is also a <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a>. The syntax rules and validation process for JavaScript-based constraints are defined in the rest of this section.
    </p>

    <section id="js-constraints-example" class="informative" typeof="bibo:Chapter" resource="#js-constraints-example" property="bibo:hasPart">
      <h3 id="h-js-constraints-example" resource="#h-js-constraints-example"><span property="xhv:role" resource="xhv:heading"><span class="secno">6.1 </span>An Example JavaScript-based Constraint</span>
      </h3>
      <p><em>This section is non-normative.</em></p>
      <p>
        The following example illustrates the syntax of a <a href="#dfn-javascript-based-constraints" class="internalDFN" data-link-type="dfn">JavaScript-based constraint</a>.
      </p>
      <pre class="example-data">ex:ValidCountry a ex:Country ;
	ex:germanLabel "Spanien"@de .
  
<span class="focus-node-error">ex:InvalidCountry</span> a ex:Country ;
	ex:germanLabel "Spain"@en .</pre>
      <pre class="example-js">function validateGermanLabel($this) {
	var results = [];
	var p = TermFactory.namedNode("http://example.org/ns#germanLabel");
	var s = $data.find($this, p, null);
	for(var t = s.next(); t; t = s.next()) {
		var object = t.object;
		if(!object.isLiteral() || !object.language.startsWith("de")) {
			results.push({
				value : object
			});
		}
	}
	return results;
}</pre>
      <pre class="example-shapes">ex:LanguageExampleShape
	a sh:NodeShape ;
	sh:targetClass ex:Country ;
	sh:js [    # _:b1
		a sh:JSConstraint ;   # This triple is optional
		sh:message "Values are literals with German language tag." ;
		sh:jsLibrary [ sh:jsLibraryURL "http://example.org/js/germanLabel.js" ] ;
		sh:jsFunctionName "validateGermanLabel" ;
	] .</pre>
      <p>
        The <a href="#dfn-target" class="internalDFN" data-link-type="dfn">target</a> of the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> above includes all <a href="#dfn-shacl-instance" class="internalDFN" data-link-type="dfn">SHACL instances</a> of <code>ex:Country</code>. For those nodes (represented by the variable <code>$this</code>), the JavaScript code walks through the <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of the property <code>ex:germanLabel</code> at <code>$this</code> and verifies that they are <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literals</a> with a German language tag. The <a href="#dfn-validation-report" class="internalDFN" data-link-type="dfn">validation report</a> for the aforementioned <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a> is shown below:
      </p>
      <pre class="example-results">[	a sh:ValidationReport ;
	sh:conforms false ;
	sh:result [
		a sh:ValidationResult ;
		sh:resultSeverity sh:Violation ;
		sh:focusNode ex:InvalidCountry ;
		sh:resultMessage "Values are literals with German language tag." ;
		sh:resultPath ex:germanLabel ;
		sh:value "Spain"@en ;
		sh:sourceConstraint _:b1 ;
		sh:sourceConstraintComponent sh:JSConstraintComponent ;
		sh:sourceShape ex:LanguageExampleShape ;
	]
] .</pre>
    </section>

    <section id="js-constraints-validation" typeof="bibo:Chapter" resource="#js-constraints-validation" property="bibo:hasPart">
      <h3 id="h-js-constraints-validation" resource="#h-js-constraints-validation"><span property="xhv:role" resource="xhv:heading"><span class="secno">6.2 </span>Validation with JavaScript-based Constraints</span>
      </h3>
      <p>
        This section defines the validator of <code>sh:JSConstraintComponent</code>.
      </p>
      <div class="def def-text">
        <div class="def-header">TEXTUAL DEFINITION</div>
        <div class="def-text-body">
          There are no validation results if the <a href="#dfn-javascript-based-constraints" class="internalDFN" data-link-type="dfn">JavaScript-based constraint</a> has <code>true</code> as a <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> for the property <code>sh:deactivated</code>. Otherwise, for each <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a> <code>F</code> and each <a href="#dfn-value-node" class="internalDFN" data-link-type="dfn">value node</a> <code>V</code> for <code>F</code>,
          <a href="#dfn-execution-of-a-javascript-executable">execute</a> the constraint's JavaScript function using the argument mapping <code>{ "this" : F, "value" : V }</code>.
          <a href="#js-constraints-results">Construct validation results</a> for each result returned by these function calls. Report a <a href="#dfn-failure" class="internalDFN" data-link-type="dfn">failure</a> if the execution of the JavaScript function results in an exception.
        </div>
      </div>
    </section>

    <section id="js-constraints-results" typeof="bibo:Chapter" resource="#js-constraints-results" property="bibo:hasPart">
      <h3 id="h-js-constraints-results" resource="#h-js-constraints-results"><span property="xhv:role" resource="xhv:heading"><span class="secno">6.3 </span>Mapping of JavaScript Results to Result Properties</span>
      </h3>
      <p>
        The following rules define how to construct <a href="#dfn-validation-result" class="internalDFN" data-link-type="dfn">validation results</a> from a given JavaScript function result <code>R</code> in the context of a given <a href="#dfn-constraint" class="internalDFN" data-link-type="dfn">constraint</a> <code>C</code> in a <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> <code>S</code>, a <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a> <code>F</code> and a <a href="#dfn-value-node" class="internalDFN" data-link-type="dfn">value node</a> <code>V</code>.
      </p>
      <ol>
        <li>
          <b>If <code>R</code> is a JavaScript <code>String</code></b>:
          <a href="#result-create">Create</a> a <a href="#dfn-validation-result" class="internalDFN" data-link-type="dfn">validation result</a> <code>?r</code>. Add a triple <code>?r sh:resultMessage ?s</code> where <code>?s</code> is an <code>xsd:string</code> literal with the JavaScript <code>String</code> as its lexical form. Add a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> <code>?r sh:value ?v</code> where <code>?v</code> is the current <a href="#dfn-value-node" class="internalDFN" data-link-type="dfn">value node</a> <code>V</code>.
        </li>
        <li>
          <b>If <code>R</code> is a JavaScript Array</b>: For each member of the Array <code>R</code> apply the rule for <a href="#result-object">JavaScript Objects</a>.
        </li>
        <li id="result-object">
          <b>If <code>R</code> is a JavaScript <code>Object</code> (not a <code>String</code>)</b>:
          <a href="#result-create">Create</a> a <a href="#dfn-validation-result" class="internalDFN" data-link-type="dfn">validation result</a> <code>?r</code>. If <code>R.value</code> is an <a href="#js-api-terms">RDF term object</a> <code>?v</code>, add a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> <code>?r sh:value ?v</code>. If <code>R.message</code> is a JavaScript <code>String</code>, add a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> <code>?r sh:resultMessage ?s</code> where <code>?s</code> is an <code>xsd:string</code> <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with the given <code>String</code> as its lexical form. Otherwise, add <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triples</a> <code>?r sh:resultMessage ?m</code> from the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> <code>S</code> following the rules defined by [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>]. If the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> <code>S</code> is a <code>node shape</code> and <code>R.path</code> is an RDF
          <a href="#js-api-iri"><code>NamedNode</code></a> object <code>?path</code>, add a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> <code>?r sh:resultPath ?path</code>.
        </li>
        <li>
          <b>If <code>R</code> is the JavaScript <code>Boolean</code> <code>false</code></b>:
          <a href="#result-create">Create</a> a <a href="#dfn-validation-result" class="internalDFN" data-link-type="dfn">validation result</a> <code>?r</code>. Add a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> <code>?r sh:value ?v</code> where <code>?v</code> is the current <a href="#dfn-value-node" class="internalDFN" data-link-type="dfn">value node</a> <code>V</code>. Add <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triples</a> <code>?r sh:resultMessage ?m</code> from the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> <code>S</code> following the rules defined by [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>].
        </li>
      </ol>
      <p id="result-create">
        <b>To create a validation result</b> <code>?r</code>, create a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> <code>?r rdf:type sh:ValidationResult</code> using the provided <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a> <code>F</code> as value for <code>sh:focusNode</code>, deriving <code>sh:resultSeverity</code> from the <code>sh:severity</code> of the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> <code>S</code> in the
        <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a> (using <code>sh:Violation</code> as default), and setting the <code>sh:resultPath</code>, <code>sh:sourceConstraintComponent</code> and <code>sh:sourceShape</code> following the rules defined by [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>]. If the result is produced by a <a href="#dfn-javascript-based-constraints" class="internalDFN" data-link-type="dfn">JavaScript-based constraint</a>, then set <code>sh:sourceConstraint</code> to the <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> of <code>sh:js</code> of the <a href="#dfn-constraint" class="internalDFN" data-link-type="dfn">constraint</a> <code>C</code> in the <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a>.
      </p>
    </section>
  </section>

  <section id="js-components" typeof="bibo:Chapter" resource="#js-components" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-js-components" resource="#h-js-components"><span property="xhv:role" resource="xhv:heading"><span class="secno">7. </span>JavaScript-based Constraint Components</span>
    </h2>
    <p>
      SHACL is based on <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint components</a>, which can be used to express <a href="#dfn-constraint" class="internalDFN" data-link-type="dfn">constraints</a> in a declarative, high-level vocabulary. For example, the constraint component <code>sh:MinCountConstraintComponent</code> defines a <a href="#dfn-parameter" class="internalDFN" data-link-type="dfn">parameter</a> <code>sh:minCount</code>. When a <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> uses one of these constraint parameters, a SHACL engine finds a suitable <a href="#dfn-validator" class="internalDFN" data-link-type="dfn">validator</a> that can produce validation results. SHACL-SPARQL [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>] defines how SPARQL queries can be used as validators. SHACL-JS defines a class <code>sh:JSValidator</code> which can be used to declare validators using JavaScript.
    </p>

    <section class="informative" id="an-example-javascript-based-constraint-component" typeof="bibo:Chapter" resource="#an-example-javascript-based-constraint-component" property="bibo:hasPart">
      <h3 id="h-an-example-javascript-based-constraint-component" resource="#h-an-example-javascript-based-constraint-component"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.1 </span>An Example JavaScript-based Constraint Component</span>
      </h3>
      <p><em>This section is non-normative.</em></p>
      <p>
        The following example demonstrates how JavaScript can be used to specify new <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint components</a> using SHACL-JS. The example implements <a href="https://www.w3.org/TR/shacl/#MaxLengthConstraintComponent"><code>sh:maxLength</code></a> using a JavaScript-based <a href="#dfn-validator" class="internalDFN" data-link-type="dfn">validator</a> to validate that the string representation of each <a href="#dfn-value-node" class="internalDFN" data-link-type="dfn">value node</a> has at most a given number of characters. Note that this is only an example implementation and should not be considered normative.
      </p>
      <pre class="example-js">function hasMaxLength($value, $maxLength) {
	if($value.isLiteral()) {
		return $value.lex.length &lt;= $maxLength.lex;
	}
	else if($value.isURI()) {
		return $value.uri.length &lt;= $maxLength.lex;
	}
	else { // Blank node
		return false;
	}
}</pre>
      <pre class="example-shapes" title="Constraint component based on JavaScript">sh:MaxLengthConstraintComponent
	a sh:ConstraintComponent ;
	sh:parameter [
		sh:path sh:maxLength ;
		sh:datatype xsd:integer ;
	] ;
	sh:validator ex:hasMaxLength .

ex:hasMaxLength
	a sh:JSValidator ;
	sh:message "Value has more than {$maxLength} characters" ;
	rdfs:comment """
		Note that $value and $maxLength are RDF nodes expressed in JavaScript Objects.
		Their string value is accessed via the .lex and .uri attributes.
		The function returns true if no violation has been found.
		""" ;
	sh:jsLibrary [ sh:jsLibraryURL "http://example.org/ns/hasMaxLength.js"^^xsd:anyURI ] ;
	sh:jsFunctionName "hasMaxLength" .</pre>
    </section>

    <section id="syntax-of-javascript-based-constraint-components" typeof="bibo:Chapter" resource="#syntax-of-javascript-based-constraint-components" property="bibo:hasPart">
      <h3 id="h-syntax-of-javascript-based-constraint-components" resource="#h-syntax-of-javascript-based-constraint-components"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.2 </span>Syntax of JavaScript-based Constraint Components</span>
      </h3>
      <p>
        The declaration of <dfn data-dfn-type="dfn" id="dfn-javascript-based-constraint-components">JavaScript-based Constraint Components</dfn> in a <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a> is very similar to <a href="https://www.w3.org/TR/shacl/#constraint-components-syntax">SPARQL-based Constraint Components</a>. In particular, components declare their <a href="#dfn-parameter" class="internalDFN" data-link-type="dfn">parameters</a> using <code>sh:parameter</code>. In fact, the same <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint component</a> may serve as a declaration of both a SPARQL-based and a JavaScript-based constraint component, assuming that <a href="#dfn-validator" class="internalDFN" data-link-type="dfn">validators</a> have been declared for both cases. Where SHACL-SPARQL uses the classes <code>sh:SPARQLSelectValidator</code> and <code>sh:SPARQLAskValidator</code>, SHACL-JS uses the class <code>sh:JSValidator</code>, which is a subclass of <code>sh:JSExecutable</code>. Each SHACL-JS validator is also a <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> and therefore has a value for <code>sh:jsFunctionName</code>.
      </p>
    </section>

    <section id="validation-of-javascript-based-constraint-components" typeof="bibo:Chapter" resource="#validation-of-javascript-based-constraint-components" property="bibo:hasPart">
      <h3 id="h-validation-of-javascript-based-constraint-components" resource="#h-validation-of-javascript-based-constraint-components"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.3 </span>Validation of JavaScript-based Constraint Components</span>
      </h3>
      <p>
        This section defines the <a href="#dfn-validator" class="internalDFN" data-link-type="dfn">validator</a> of <a href="#dfn-javascript-based-constraint-components" class="internalDFN" data-link-type="dfn">JavaScript-based constraint components</a>.
      </p>
      <div class="def def-text">
        <div class="def-header">TEXTUAL DEFINITION</div>
        <div class="def-text-body">
          Let <code>?E</code> be the <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> selected for the <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint component</a>
          <code>?C</code> based on the rules outlined in
          <a href="https://www.w3.org/TR/shacl/#constraint-components-validators">section 6.2.3</a> of [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>]. If the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> is a <a href="#dfn-property-shape" class="internalDFN" data-link-type="dfn">property shape</a> and the <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a> contains a <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a>
          <code>?C sh:propertyValidator ?E</code> then let <code>path</code> be the value of <code>sh:path</code> at the <a href="#dfn-shape" class="internalDFN" data-link-type="dfn">shape</a> in the <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a>, and <a href="#dfn-execution-of-a-javascript-executable">execute</a>
          <code>?E</code> for each <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a> <code>F</code> using a mapping <code>{ "this" : F, "path" : path }</code>. (The validator's JavaScript function can access the <code>path</code> structure in the <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a> <code>$shapes</code>, assuming the function declares <code>$path</code> as one of its parameters.) Otherwise, for each <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a> <code>F</code> and each <a href="#dfn-value-node" class="internalDFN" data-link-type="dfn">value node</a> <code>V</code>,
          <a href="#dfn-execution-of-a-javascript-executable">execute</a> <code>?E</code> using a mapping <code>{ "this" : F, "value" : V }</code>.
          <a href="#js-constraints-results">Construct validation results</a> for each result returned by these function calls. Report a <a href="#dfn-failure" class="internalDFN" data-link-type="dfn">failure</a> if the execution of the JavaScript function results in an exception.
        </div>
      </div>
    </section>

  </section>

  <section id="js-functions" typeof="bibo:Chapter" resource="#js-functions" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-js-functions" resource="#h-js-functions"><span property="xhv:role" resource="xhv:heading"><span class="secno">8. </span>JavaScript-based Functions</span>
    </h2>
    <p>
      The SHACL Advanced Features includes a generic mechanism to declare new <a href="#dfn-shacl-function" class="internalDFN" data-link-type="dfn">SHACL functions</a>. In particular this is used to declare new SPARQL functions, using the class <code>sh:SPARQLFunction</code>. SHACL-JS includes a very similar mechanism, allowing users to declare new functions in an RDF vocabulary so that certain engines can use them. Functions declared using the SHACL-JS vocabulary can, among others, be used by function calls in SPARQL FILTER or BIND clauses and in <a href="#dfn-rule" class="internalDFN" data-link-type="dfn">SHACL rules</a>.
    </p>

    <section class="informative" id="an-example-javascript-based-function" typeof="bibo:Chapter" resource="#an-example-javascript-based-function" property="bibo:hasPart">
      <h3 id="h-an-example-javascript-based-function" resource="#h-an-example-javascript-based-function"><span property="xhv:role" resource="xhv:heading"><span class="secno">8.1 </span>An Example JavaScript-based Function</span>
      </h3>
      <p><em>This section is non-normative.</em></p>
      <p>
        The following example demonstrates how JavaScript can be used to specify new SHACL function. The function can be used, for example in SPARQL using <code>BIND (ex:square(4) AS ?s)</code>.
      </p>
      <pre class="example-js">function square($number) {
	return $number.lex * $number.lex;
}</pre>
      <pre class="example-shapes" title="Function based on JavaScript">ex:square
	a sh:JSFunction ;
	sh:parameter [
		sh:path ex:number ;
		sh:datatype xsd:integer ;
	] ;
	sh:returnType xsd:integer ;
	sh:jsLibrary [ sh:jsLibraryURL "http://example.org/js/square.js"^^xsd:anyURI ] ;
	sh:jsFunctionName "square" .</pre>
    </section>

    <section id="syntax-and-semantics-of-javascript-based-functions" typeof="bibo:Chapter" resource="#syntax-and-semantics-of-javascript-based-functions" property="bibo:hasPart">
      <h3 id="h-syntax-and-semantics-of-javascript-based-functions" resource="#h-syntax-and-semantics-of-javascript-based-functions"><span property="xhv:role" resource="xhv:heading"><span class="secno">8.2 </span>Syntax and Semantics of JavaScript-based Functions</span>
      </h3>
      <p>
        The syntax of <dfn data-dfn-type="dfn" id="dfn-javascript-based-functions">JavaScript-based functions</dfn> is very similar to SPARQL-based functions. Each <a href="#dfn-shacl-instance" class="internalDFN" data-link-type="dfn">SHACL instance</a> of <code>sh:JSFunction</code> in a <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a>, that is an <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRI</a>, declares one function. The <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRI</a> identifies the function, for example, in SPARQL queries. The function parameters are declared using <code>sh:parameter</code> in the same way as the <a href="#dfn-parameter" class="internalDFN" data-link-type="dfn">parameters</a> of <a href="#dfn-constraint-component" class="internalDFN" data-link-type="dfn">constraint components</a> are declared. The optional property <code>sh:returnType</code> can be used to specify the type of results produced by the function. Finally, <code>sh:JSFunction</code> is a subclass of <code>sh:JSExecutable</code>, and the syntax rules of <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executables</a> apply to functions, too. In particular, each JavaScript-based function has one <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> of <code>sh:jsFunctionName</code>. This is the name of the JavaScript function that is executed whenever the (SHACL) function is called.
      </p>
      <p>
        The JavaScript result <code>R</code> of the <a href="#dfn-execution-of-a-javascript-executable">execution of the function</a> is turned into an <a href="#dfn-node" class="internalDFN" data-link-type="dfn">RDF node</a> using the following rules:
      </p>
      <ol>
        <li>
          <b>If <code>R</code> is a <code>String</code>:</b> return an <code>xsd:string</code> <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with the string as its lexical form
        </li>
        <li>
          <b>If <code>R</code> is an <code>Object</code> representing an <a href="#dfn-node" class="internalDFN" data-link-type="dfn">RDF node</a>:</b> return <code>R</code>
        </li>
        <li>
          <b>If <code>R</code> is a <code>Number</code> and the function declares a <code>sh:returnType</code> <code>T</code>
						and the Number can be converted to a well-formed <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with datatype <code>T</code>:</b> return a <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with datatype <code>T</code> and the given value as lexical form
        </li>
        <li>
          <b>If <code>R</code> is a <code>Number</code> that can be converted to a well-formed <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with datatype <code>xsd:decimal</code>:</b> return an <code>xsd:decimal</code> <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with the given value as lexical form
        </li>
        <li>
          <b>If <code>R</code> is a Boolean:</b> return an <code>xsd:boolean</code> <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literal</a> with the given value as lexical form
        </li>
        <li>
          <b>Otherwise:</b> return no result
        </li>
      </ol>
      <p>
        During the execution of a JavaScript function, the variable <code>$data</code> can be used to access the current query graph, while the variable <code>$shapes</code> is undefined.
      </p>
    </section>
  </section>

  <section id="rules" typeof="bibo:Chapter" resource="#rules" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-rules" resource="#h-rules"><span property="xhv:role" resource="xhv:heading"><span class="secno">9. </span>JavaScript Rules</span>
    </h2>
    <p>
      The SHACL Advanced Features document introduced the concept of SHACL-based <a href="#dfn-rule" class="internalDFN" data-link-type="dfn">rules</a> which included an extension mechanism that can be used to define new <a href="#dfn-rule-type" class="internalDFN" data-link-type="dfn">rule types</a>. This section defines a <a href="#dfn-rule-type" class="internalDFN" data-link-type="dfn">rule type</a> called <dfn data-dfn-type="dfn" id="dfn-javascript-rules">JavaScript rules</dfn>.
    </p>
    <p>
    </p>
    <table class="term-table">
      <tbody>
        <tr>
          <th>Rule Type IRI</th>
          <th>Key Property</th>
          <th>Other Properties</th>
        </tr>
        <tr>
          <td><code>sh:JSRule</code></td>
          <td><a href="#jsFunctionName"><code>sh:jsFunctionName</code></a></td>
          <td><a href="#jsLibrary"><code>sh:jsLibrary</code></a></td>
        </tr>
      </tbody>
    </table>

    <section id="rules-example" class="informative" typeof="bibo:Chapter" resource="#rules-example" property="bibo:hasPart">
      <h3 id="h-rules-example" resource="#h-rules-example"><span property="xhv:role" resource="xhv:heading"><span class="secno">9.1 </span>An Example JavaScript Rule</span>
      </h3>
      <p><em>This section is non-normative.</em></p>
      <p>
        The following example illustrates the use of a <a href="#dfn-javascript-rules" class="internalDFN" data-link-type="dfn">JavaScript rule</a> to compute the area of a rectangle, by multiplying width and height.
      </p>
      <pre class="example-js">var NS = "http://datashapes.org/js/tests/rules/rectangle.test#";

function computeArea($this) {
	var width = getProperty($this, "width");
	var height = getProperty($this, "height");
	var area = TermFactory.literal(width.lex * height.lex, width.datatype);
	var areaProperty = TermFactory.namedNode(NS + "area");
	return [ [$this, areaProperty, area] ]; 
}

function getProperty($this, name) {
	var it = $data.find($this, TermFactory.namedNode(NS + name), null);
	var result = it.next().object;
	it.close();
	return result;
}</pre>
      <p>
        Note that this code is quite verbose because it uses only the very basic SHACL JavaScript API. In real-world examples, a higher level API with convenience methods is likely used.
      </p>
      <pre class="example-shapes" title="Rules example">ex:RectangleShape
	a sh:NodeShape ;
	sh:targetClass ex:Rectangle ;
	sh:rule [
		a sh:JSRule ;    # This triple is optional
		sh:jsFunctionName "computeArea" ;
		sh:jsLibrary [ sh:jsLibraryURL "http://example.org/js/rectangle.js"^^xsd:anyURI ] ;
    ] .</pre>
      <p>
        For the following <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a>, the <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triples</a> below would be produced.
      </p>
      <pre class="example-data">ex:ExampleRectangle
	a ex:Rectangle ;
	ex:width 7 ;
	ex:height 8 .</pre>
      <p>
        Inferred triples:
      </p>
      <pre class="example-inferences">	ex:ExampleRectangle ex:area 56 .</pre>
    </section>

    <section id="rules-execution" typeof="bibo:Chapter" resource="#rules-execution" property="bibo:hasPart">
      <h3 id="h-rules-execution" resource="#h-rules-execution"><span property="xhv:role" resource="xhv:heading"><span class="secno">9.2 </span>Execution Instructions for JavaScript Rules</span>
      </h3>
      <div class="def def-text">
        <div class="def-header">TEXTUAL DEFINITION</div>
        <div class="def-text-body">
          Prior to execution, ensure that all JavaScript libraries for the <a href="#dfn-rule" class="internalDFN" data-link-type="dfn">rule</a> (specified via <code>sh:jsLibrary</code>) have been executed. For each <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a>, <a href="#dfn-execution-of-a-javascript-executable">execute</a> the JavaScript function specified as the <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> of
          <code>sh:jsFunctionName</code> at the <a href="#dfn-rule" class="internalDFN" data-link-type="dfn">rule</a> in the <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a>, using the <a href="#dfn-focus-node" class="internalDFN" data-link-type="dfn">focus node</a> as the first (and only) argument into the function. If the result <code>R</code> of the function call is an Array then for each member <code>O</code> of this Array apply the instructions below.
        </div>
      </div>
      <ol>
        <li>
          <b>If <code>O</code> is an Array:</b> Infer a new <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> with <a href="#dfn-subject" class="internalDFN" data-link-type="dfn">subject</a> <code>O[0]</code>,
          <a href="#dfn-predicate" class="internalDFN" data-link-type="dfn">predicate</a> <code>O[1]</code> and <a href="#dfn-object" class="internalDFN" data-link-type="dfn">object</a> <code>O[2]</code>.
        </li>
        <li>
          <b>If <code>O</code> is another <code>Object</code>:</b> Infer a new <a href="#dfn-triple" class="internalDFN" data-link-type="dfn">triple</a> with <a href="#dfn-subject" class="internalDFN" data-link-type="dfn">subject</a> <code>O.subject</code>, <a href="#dfn-predicate" class="internalDFN" data-link-type="dfn">predicate</a> <code>O.predicate</code> and <a href="#dfn-object" class="internalDFN" data-link-type="dfn">object</a> <code>O.object</code>.
        </li>
      </ol>
      <p>
        In other words, each member of the Array returned by the JavaScript function must either be another Array with three members (for <a href="#dfn-subject" class="internalDFN" data-link-type="dfn">subject</a>, <a href="#dfn-predicate" class="internalDFN" data-link-type="dfn">predicate</a> and <a href="#dfn-object" class="internalDFN" data-link-type="dfn">object</a>), of a JavaScript Object with three fields <code>subject</code>, <code>predicate</code> and <code>object</code>.
      </p>
    </section>
  </section>

  <section id="targets" typeof="bibo:Chapter" resource="#targets" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-targets" resource="#h-targets"><span property="xhv:role" resource="xhv:heading"><span class="secno">10. </span>JavaScript-based Custom Targets</span>
    </h2>
    <p>
      As one of the SHACL Advanced Features, <a href="#dfn-custom-target" class="internalDFN" data-link-type="dfn">custom targets</a> define a mechanism to compute <a href="#dfn-target" class="internalDFN" data-link-type="dfn">target</a> nodes by more flexible means than the built-in target types. Similar to SPARQL-based targets, this section introduces <a href="#dfn-custom-target" class="internalDFN" data-link-type="dfn">custom targets</a> based on JavaScript.
    </p>

    <section id="JSTarget" typeof="bibo:Chapter" resource="#JSTarget" property="bibo:hasPart">
      <h3 id="h-jstarget" resource="#h-jstarget"><span property="xhv:role" resource="xhv:heading"><span class="secno">10.1 </span>JavaScript-based Targets (sh:JSTarget)</span>
      </h3>
      <p>
        <a href="#dfn-custom-target" class="internalDFN" data-link-type="dfn">Custom targets</a> that are <a href="#dfn-shacl-instance" class="internalDFN" data-link-type="dfn">SHACL instances</a> of <code>sh:JSTarget</code> are called
        <dfn data-dfn-type="dfn" id="dfn-javascript-based-targets">JavaScript-based targets</dfn>.
      </p>
      <p class="syntax">
        <span data-syntax-rule="JSTarget" id="syntax-rule-JSTarget"><a href="#dfn-javascript-based-targets" class="internalDFN" data-link-type="dfn">JavaScript-based targets</a> have the same syntax rules as
					<a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executables</a> (e.g., requires a <code>sh:jsFunctionName</code>).
					The function must return a JavaScript Array where each member is an RDF term Object.</span>
      </p>
      <div class="def def-text">
        <div class="def-header">TEXTUAL DEFINITION</div>
        <div class="def-text-body">
          Let <code>T</code> be a <a href="#dfn-javascript-based-targets" class="internalDFN" data-link-type="dfn">JavaScript-based target</a>. The <a href="#dfn-target" class="internalDFN" data-link-type="dfn">target</a> nodes of <code>T</code> are the <a href="#dfn-node" class="internalDFN" data-link-type="dfn">nodes</a> in the Array returned by its
          <a href="#dfn-execution-of-a-javascript-executable">execution</a> against the <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a>.
        </div>
      </div>
    </section>

    <section id="JSTargetType" typeof="bibo:Chapter" resource="#JSTargetType" property="bibo:hasPart">
      <h3 id="h-jstargettype" resource="#h-jstargettype"><span property="xhv:role" resource="xhv:heading"><span class="secno">10.2 </span>JavaScript-based Target Types (sh:JSTargetType)</span>
      </h3>
      <p>
        Very similar to <a href="https://www.w3.org/TR/shacl-af/#SPARQLTargetType">SPARQL-based	target types</a>, there is a class <code>sh:JSTargetType</code> declared as <code>rdfs:subClassOf sh:TargetType</code> for <dfn data-dfn-type="dfn" id="dfn-javascript-based-target-types">JavaScript-based target types</dfn>.
      </p>
      <p class="syntax">
        <span data-syntax-rule="JSTargetType" id="syntax-rule-JSTargetType"><a href="#dfn-javascript-based-target-types" class="internalDFN" data-link-type="dfn">JavaScript-based target types</a> have the same syntax rules as
					<a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executables</a> (e.g., requires a <code>sh:jsFunctionName</code>).
					The function must return a JavaScript Array where each member is an RDF term Object.</span>
      </p>
      <div class="def def-text">
        <div class="def-header">TEXTUAL DEFINITION</div>
        <div class="def-text-body">
          Let <code>T</code> be a <a href="#dfn-javascript-based-targets" class="internalDFN" data-link-type="dfn">JavaScript-based target</a> of target type <code>Y</code>. The <a href="#dfn-target" class="internalDFN" data-link-type="dfn">target</a> nodes of <code>T</code> are the <a href="#dfn-node" class="internalDFN" data-link-type="dfn">nodes</a> in the Array returned by the
          <a href="#dfn-execution-of-a-javascript-executable">execution</a> of <code>Y</code> against the <a href="#dfn-data-graph" class="internalDFN" data-link-type="dfn">data graph</a>. Similar to <a href="#js-components">JavaScript-based constraint components</a>, for the execution of the JavaScript function, all <a href="#dfn-parameter" class="internalDFN" data-link-type="dfn">parameter</a> values of <code>T</code> are mapped to the JavaScript arguments by the <a href="#dfn-local-name" class="internalDFN" data-link-type="dfn">local name</a> of the <a href="#dfn-parameter" class="internalDFN" data-link-type="dfn">parameter</a> property (for example, <code>ex:country</code> is passed into the function as values of <code>$country</code>).
        </div>
      </div>
    </section>
  </section>

  <div style="padding-top: 30px">
    <h1 id="appendix" style="font-size: 160%; font-weight: bold">Appendix</h1>
  </div>

  <section id="syntax-rules" class="appendix" typeof="bibo:Chapter" resource="#syntax-rules" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-syntax-rules" resource="#h-syntax-rules"><span property="xhv:role" resource="xhv:heading"><span class="secno">A. </span>Summary of SHACL-JS Syntax Rules</span>
    </h2>
    <p>
      This section enumerates all normative syntax rules of SHACL-JS. This section is automatically generated from other parts of this spec and hyperlinks are provided back into the prose if the context of the rule in unclear. Nodes that violate these rules in a <a href="#dfn-shapes-graph" class="internalDFN" data-link-type="dfn">shapes graph</a> are <a href="#dfn-ill-formed" class="internalDFN" data-link-type="dfn">ill-formed</a>.
    </p>
    <table class="term-table" id="syntax-rules-table">
      <tbody>
        <tr>
          <th>Syntax Rule Id</th>
          <th>Syntax Rule Text</th>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-jsFunctionName-count">jsFunctionName-count</a></td>
          <td>Every <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> must have exactly one <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> for the property <code>sh:jsFunctionName</code>.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-jsFunctionName-datatype">jsFunctionName-datatype</a></td>
          <td>The values of <code>sh:jsFunctionName</code> are <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literals</a> with <a href="#dfn-datatype" class="internalDFN" data-link-type="dfn">datatype</a> <code>xsd:string</code>.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-jsLibrary-minCount">jsLibrary-minCount</a></td>
          <td>Every <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executable</a> must have at least one <a href="#dfn-value" class="internalDFN" data-link-type="dfn">value</a> for the property <code>sh:jsLibrary</code>.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-jsLibrary-nodeKind">jsLibrary-nodeKind</a></td>
          <td>The <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of the property <code>sh:jsLibrary</code> are <a href="#dfn-iri" class="internalDFN" data-link-type="dfn">IRIs</a> or <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn">blank nodes</a>.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-jsLibrary-class">jsLibrary-class</a></td>
          <td>The <a href="#dfn-value" class="internalDFN" data-link-type="dfn">values</a> of the property <code>sh:jsLibrary</code> are well-formed SHACL instances of the class <code>sh:JSLibrary</code>.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-jsLibraryURL-datatype">jsLibraryURL-datatype</a></td>
          <td>The values of the property <code>sh:jsLibraryURL</code> are <a href="#dfn-literal" class="internalDFN" data-link-type="dfn">literals</a> with <a href="#dfn-datatype" class="internalDFN" data-link-type="dfn">datatype</a> <code>xsd:anyURI</code>.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-JSTarget">JSTarget</a></td>
          <td><a href="#dfn-javascript-based-targets" class="internalDFN" data-link-type="dfn">JavaScript-based targets</a> have the same syntax rules as
            <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executables</a> (e.g., requires a <code>sh:jsFunctionName</code>). The function must return a JavaScript Array where each member is an RDF term Object.</td>
        </tr>
        <tr class="syntax-rule-tr">
          <td class="#syntax-rule-id&quot;"><a class="syntax-rule-id-a" href="#syntax-rule-JSTargetType">JSTargetType</a></td>
          <td><a href="#dfn-javascript-based-target-types" class="internalDFN" data-link-type="dfn">JavaScript-based target types</a> have the same syntax rules as
            <a href="#dfn-javascript-executables" class="internalDFN" data-link-type="dfn">JavaScript executables</a> (e.g., requires a <code>sh:jsFunctionName</code>). The function must return a JavaScript Array where each member is an RDF term Object.</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section id="security" class="appendix informative" typeof="bibo:Chapter" resource="#security" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-security" resource="#h-security"><span property="xhv:role" resource="xhv:heading"><span class="secno">B. </span>Security and Privacy Considerations</span>
    </h2>
    <p><em>This section is non-normative.</em></p>
    <p>
      SHACL-JS shares certain security and privacy considerations with those <a href="https://www.w3.org/TR/shacl/#security">mentioned</a> in [<cite><a class="bibref" href="#bib-shacl">shacl</a></cite>]. In addition, JavaScript opens a whole new range of topics that are outside of the scope of this document. The general advice is for users to only use trusted and controlled shape graphs.
    </p>
  </section>



  <section id="references" class="appendix" typeof="bibo:Chapter" resource="#references" property="bibo:hasPart">
    <!--OddPage-->
    <h2 id="h-references" resource="#h-references"><span property="xhv:role" resource="xhv:heading"><span class="secno">C. </span>References</span>
    </h2>

    <section id="normative-references" typeof="bibo:Chapter" resource="#normative-references" property="bibo:hasPart">
      <h3 id="h-normative-references" resource="#h-normative-references"><span property="xhv:role" resource="xhv:heading"><span class="secno">C.1 </span>Normative references</span>
      </h3>
      <dl class="bibliography" resource=""><dt id="bib-BCP47">[BCP47]</dt>
        <dd><a href="https://tools.ietf.org/html/bcp47" property="dc:requires"><cite>Tags for Identifying Languages</cite></a>. A. Phillips; M. Davis. IETF. September 2009. IETF Best Current Practice. URL: <a href="https://tools.ietf.org/html/bcp47" property="dc:requires">https://tools.ietf.org/html/bcp47</a>
        </dd><dt id="bib-RFC2119">[RFC2119]</dt>
        <dd><a href="https://tools.ietf.org/html/rfc2119" property="dc:requires"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner. IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119" property="dc:requires">https://tools.ietf.org/html/rfc2119</a>
        </dd><dt id="bib-rdf11-concepts">[rdf11-concepts]</dt>
        <dd><a href="https://www.w3.org/TR/rdf11-concepts/" property="dc:requires"><cite>RDF 1.1 Concepts and Abstract Syntax</cite></a>. Richard Cyganiak; David Wood; Markus Lanthaler. W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf11-concepts/" property="dc:requires">https://www.w3.org/TR/rdf11-concepts/</a>
        </dd><dt id="bib-shacl">[shacl]</dt>
        <dd><a href="https://www.w3.org/TR/shacl/" property="dc:requires"><cite>Shapes Constraint Language (SHACL)</cite></a>. Holger Knublauch; Dimitris Kontokostas. W3C. 11 April 2017. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/shacl/" property="dc:requires">https://www.w3.org/TR/shacl/</a>
        </dd><dt id="bib-shacl-af">[shacl-af]</dt>
        <dd><a href="https://www.w3.org/TR/shacl-af/" property="dc:requires"><cite>SHACL Advanced Features</cite></a>. Holger Knublauch; Dean Allemang; Simon Steyskal. W3C. W3C Working Group Note. URL: <a href="https://www.w3.org/TR/shacl-af/" property="dc:requires">https://www.w3.org/TR/shacl-af/</a>
        </dd><dt id="bib-turtle">[turtle]</dt>
        <dd><a href="https://www.w3.org/TR/turtle/" property="dc:requires"><cite>RDF 1.1 Turtle</cite></a>. Eric Prud'hommeaux; Gavin Carothers. W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/turtle/" property="dc:requires">https://www.w3.org/TR/turtle/</a>
        </dd>
      </dl>
    </section>

    <section id="informative-references" typeof="bibo:Chapter" resource="#informative-references" property="bibo:hasPart">
      <h3 id="h-informative-references" resource="#h-informative-references"><span property="xhv:role" resource="xhv:heading"><span class="secno">C.2 </span>Informative references</span>
      </h3>
      <dl class="bibliography" resource=""><dt id="bib-sparql11-query">[sparql11-query]</dt>
        <dd><a href="https://www.w3.org/TR/sparql11-query/" property="dc:references"><cite>SPARQL 1.1 Query Language</cite></a>. Steven Harris; Andy Seaborne. W3C. 21 March 2013. W3C Recommendation. URL: <a href="https://www.w3.org/TR/sparql11-query/" property="dc:references">https://www.w3.org/TR/sparql11-query/</a>
        </dd>
      </dl>
    </section>
  </section>
  <p role="navigation" id="back-to-top"><a href="#toc"><abbr title="Back to Top">↑</abbr></a></p>
  <script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
</body>
</html>